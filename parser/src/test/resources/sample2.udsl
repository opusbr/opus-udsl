package br.com.opussoftware.examples.petshop



Environment("gcsf")  {

	Endpoint('www.petshop.com.br') {
		Route( path: "/", deployment: "Frontend")
		Route( path: "/clientes", deployment: "SvcCliente")
	}

	// Gera projeto angular com consumo dos contratos
	// Gera deployment com NGINX e configuração de proxy reverso
	Deployment (name:'Frontend', tags: [frontend:true]) {
		Image( name: "opussoftware/frontend:prod")
		Deployment("Form1") // Consome outro deployment via proxy reverso no backend
		//Endpoint('www.petshop.com.br') // Consume todas as rotas
		Endpoint('www.petshop.com.br', routes: ["/clientes"]) // Consume as rotas indicadas
	}

	// Microfrontend
	Deployment ('Form1') {
		Image( name: "opussoftware/form1")
	}

	// API Rest
	Deployment ('SvcCliente') {
		Image( name: "cliente") {
			Route( path: "/clientes", contract: "cliente.yml")
		}
		
		Endpoint( "mydb" )
		Route(deployment:"SvcFeedback" )
		MessageChannel( name: "FilaAuditoria", role: "Producer" )
	}

	Deployment ('SvcFeedback') {
		Image( name: "feedback") {
			Route( contract: "feedback.yml") // Declara rota e contrato
		}
		Endpoint( "mydb" )
	}

}
